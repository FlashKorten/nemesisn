<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
	  <link rel="stylesheet" href="list.css" type="text/css" media="screen"/>
    <script type="text/javascript" src="jquery.min.js"> </script>
    <script type="text/javascript">

      $(document).ready(function() {
        getDrillerJson();
        $('.nojs').hide();
        $('#author').css("color", "red");
      });

function collectParams() {
  var query = "";
  $(".selector").each(function() {
    if ($(this).val()) {
      var box = "input:checked#" + this.id + "box";
      var v = Math.abs($(this).val());
      query += ((query === "") ? "" : "&")
            + this.id + "="
            + ($(box).length > 0 ? (-1) * v : v);
    }
  });
  return query;
}

updateList = function(item) {
  var category = $(item).parent().attr("id");
  var list_type = $(item).attr("class");
  if (list_type === 'header') {
    var entries = $(item).siblings('.hidden');
    console.log("Found "+entries.length+" hidden entries.");
    if (entries.length > 0) {
      entries.removeClass('hidden');
    } else {
      var entries = $(item).siblings();
      entries.addClass('hidden');
    }
  }
  console.log("Cat: "+category+", Type: "+list_type);

}

updateLinks = function() {
  $('ul.selector li').click( function() { updateList(this) });
}

function getDrillerJson() {
  $.getJSON("http://bohr/driller/q", collectParams(), function(data){
  updateSelector(data, "Authors", "author", getId, getName);
  updateSelector(data, "Publishers", "publisher", getId, getName);
  $('#info').empty().append('#scenarios: '+ data["NoResults"]);
  updateLinks();
  });
}

getId = function(data){
  return data["Id"];
}

getName = function(data){
  return data["Name"];
}

getValue = function(data){
  return data["Value"];
}

getGameValue = function(data){
  return data["Title"]+((data["Subtitle"].length > 0) ? " &mdash; "+data["Subtitle"] : "");
}

updateSelector = function(data, f1, f2, idGetter, valueGetter) {
  if ($('#'+f2+' selected').val() === "") {
    if (data[f1].Entries.length === 1) {
      var dp = data[f1].Entries[0];
      $('#'+f2).empty().append(
          "<li class='reset'><div class='value><\/div><div class='text'>Clear filter<\/div><\/li>" +
          "<li><div class='value selected'=\""+idGetter(dp)+"\"><div id='text'>"+valueGetter(dp)+"<\/div><\/li>");
    }
    return;
  }
  var g = "<li class='header'><div class='value'><\/div><div class='text'>"+f1+"(";
  if (data[f1].Groups != undefined) {
    var gr = "";
    var num = 0;
    for (d in data[f1].Groups) {
      num += data[f1].Groups[d]["Matches"];
      gr += "<li class='group hidden'><div class='value'>"+data[f1].Groups[d].GroupId+"<\/div><div class='text'>"+data[f1].Groups[d].GroupId+"  ("+data[f1].Groups[d].Matches+")<\/div><\/li>";
    }
    g += num+")<\/div><\/li>"+gr;
  } else if (data[f1].Entries.length >= 0) {
    g += data[f1].Entries.length+')<\/div><\/li>'
    for (d in data[f1].Entries) {
      var dp = data[f1].Entries[d];
      g += "<li class='entry hidden'><div class='value'>"+idGetter(dp)+"<\/div><div class='text'>"+valueGetter(dp)+"<\/div><\/li>";
    }
  }
  $('#'+f2).empty().append(g);
}

    </script>
    <title>JS-Test</title>
  </head>
  <body id="Schnasenfoo" onload="">
      <div style='margin:10px'>
        <ul class='selector' id='author'>
          <li><div class='value'></div><div class='text'>Author</div></li>
        </ul>
      </div>
      <div style='margin:10px'>
        <ul class='selector' id='publisher'>
          <li><div class='value'></div><div class='text'>Publisher</div></li>
        </ul>
      </div>
    <p id="info"></p>
  </body>
</html>
